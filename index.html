<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RDMex</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🚀</text></svg>">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap:; connect-src 'self' https://api.real-debrid.com https://raw.githubusercontent.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; font-src 'self' https://cdn.jsdelivr.net; script-src 'self' 'unsafe-inline' 'unsafe-eval';">
    
    <!-- External Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />
    
    <!-- Custom Styles -->
    <style>
        /* Custom Styles for Toast and Animations */
        #toastContainer {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: 90%;
            max-width: 500px;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom scrollbar for better aesthetics */
        #statusLog::-webkit-scrollbar, #torrentList::-webkit-scrollbar, #file-list-container::-webkit-scrollbar {
            width: 8px;
        }
        #statusLog::-webkit-scrollbar-thumb, #torrentList::-webkit-scrollbar-thumb, #file-list-container::-webkit-scrollbar-thumb {
            background-color: #a0aec0;
            border-radius: 4px;
        }
        #statusLog::-webkit-scrollbar-track, #torrentList::-webkit-scrollbar-track, #file-list-container::-webkit-scrollbar-track {
            background-color: #edf2f7;
        }
        /* Style adjustments for better button feedback */
        .btn-potplayer { background-color: #4b3279; color: white; }
        .btn-potplayer:hover { background-color: #5d3f99; }
        .btn-stream { background-color: #8B5CF6; color: white; }
        .btn-stream:hover { background-color: #7C3AED; }
        .btn-rdpage { background-color: #3B82F6; color: white; }
        .btn-rdpage:hover { background-color: #2563EB; }
        .btn-download { background-color: #10B981; color: white; }
        .btn-download:hover { background-color: #059669; }
        .btn-link { background-color: #6B7280; color: white; }
        .btn-link:hover { background-color: #4B5563; }
        .btn-hide { background-color: #9CA3AF; color: white; }
        .btn-hide:hover { background-color: #6B7280; }
        .btn-delete { background-color: #EF4444; color: white; }
        .btn-delete:hover { background-color: #DC2626; }
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-800 text-white p-4 shadow-md flex justify-between items-center sticky top-0 z-40">
      <div><h1 class="text-2xl font-bold flex items-center"><i class="fas fa-rocket mr-3"></i>RDMex</h1></div>
      <div id="apiListSize" class="text-right opacity-90 text-xl font-bold"></div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 md:px-6 py-8 max-w-7xl">
      
      <!-- Input Section -->
      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <div class="flex flex-col md:flex-row gap-6">
            <!-- Magnet Input -->
            <div class="flex-1 flex relative h-32 md:h-auto">
                <div id="magnetPlaceholder" class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none transition-opacity duration-300">
                    <i class="fas fa-magnet text-4xl text-gray-400"></i>
                    <p class="mt-2 text-sm text-gray-600">마그넷 링크를 여기에 붙여넣으세요</p>
                </div>
                <textarea id="magnetInput" rows="2" class="w-full h-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-left bg-transparent z-10 md:min-h-[128px]"></textarea>
            </div>
            <!-- Torrent File Input -->
            <div class="flex-1 flex h-32 md:h-auto">
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center w-full h-full flex flex-col justify-center items-center relative cursor-pointer" id="dropZone">
                    <input type="file" id="torrentFile" accept=".torrent" class="hidden" />
                    <div id="dropZoneContent" class="flex flex-col items-center justify-center h-full">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                        <p class="mt-2 text-sm text-gray-600">.torrent 파일을 드롭하거나 클릭하여 추가</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2-Button Upload Layout -->
        <div class="flex flex-col md:flex-row gap-4 mt-6">
            <!-- Button 1: Magnet or Convert Upload -->
            <button onclick="handleConvertUpload(this)" id="convertUploadButton" class="w-full px-4 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition duration-200 flex items-center justify-center text-xl flex-1">
                <i class="fas fa-magnet mr-3"></i> 마그넷 / 변환 업로드
            </button>
            
            <!-- Button 2: Torrent File Direct Upload -->
            <button onclick="handleDirectUpload(this)" id="directUploadButton" class="w-full px-4 py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition duration-200 flex items-center justify-center text-xl flex-1 opacity-50 cursor-not-allowed" disabled>
                <i class="fas fa-file-arrow-up mr-3"></i> 파일 직접 업로드
            </button>
        </div>
        
        <!-- Tracker Section -->
        <div class="mt-6">
          <div class="flex justify-between items-center mb-1">
            <label for="trackerInput" class="block text-sm font-medium text-gray-700 flex items-center">
                <span class="cursor-pointer" onclick="fetchBestTrackers()">
                    <i class="fas fa-satellite-dish mr-2 text-purple-500"></i>최신 트래커 불러오기
                </span>
                <span id="trackerStatusIcon" class="ml-2"></span>
            </label>
            <div id="trackerUpdateTime" class="text-xs font-bold text-gray-500 ml-3 text-right"></div>
          </div>
          <div class="relative">
            <textarea id="trackerInput" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="RD 추가 시 마그넷에 적용할 트래커 목록입니다. 최신 목록을 자동으로 불러옵니다..."></textarea>
          </div>
        </div>
      </div>

      <!-- Torrent List, Log, API Sections -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Left Column: Torrent List -->
        <div class="bg-white rounded-lg shadow-lg relative" style="height: 600px">
          <div class="absolute top-0 left-0 right-0 p-4 h-16 border-b border-gray-200 flex justify-between items-center">
              <h2 class="text-xl font-semibold text-gray-800"><i class="fas fa-list mr-2 text-blue-500"></i>토렌트 목록</h2>
              <div class="flex gap-2">
                  <button onclick="refreshTorrents()" class="px-3 py-1 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700" title="새로고침"><i class="fas fa-sync-alt"></i></button>
                  <button onclick="deleteCompleted()" class="px-3 py-1 bg-red-600 text-white text-sm font-semibold rounded-lg hover:bg-red-700" title="완료된 항목 모두 삭제"><i class="fas fa-trash"></i></button>
              </div>
          </div>
          <div class="absolute top-16 bottom-0 left-0 right-0 overflow-y-auto"><div id="torrentList" class="p-2"><p class="text-gray-500 text-center py-8">토렌트 목록을 불러오려면 새로고침 버튼을 클릭하세요.</p></div></div>
        </div>

        <!-- Right Column: Status Log and API -->
        <div class="flex flex-col gap-8">
          <div class="bg-white rounded-lg shadow-lg p-6 flex-grow flex flex-col">
            <h2 class="text-xl font-semibold mb-4 flex items-center text-gray-800 border-b pb-3"><i class="fas fa-info-circle mr-2 text-blue-500"></i>상태 및 로그</h2>
            <div id="statusLog" class="bg-gray-50 rounded-lg p-3 flex-1 overflow-y-auto text-sm">
                <p id="initialLogMessage" class="text-gray-500">준비 완료.</p>
            </div>
          </div>
          <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold flex items-center text-gray-800"><i class="fas fa-key mr-2 text-yellow-500"></i>API 설정</h2>
                <div id="apiCombinedStatus" class="ml-3 text-sm"></div>
            </div>
            <input type="password" id="apiToken" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Real-Debrid API 토큰을 입력하세요" />
            <p class="text-xs text-gray-500 mt-2">API 토큰은 <a href="https://real-debrid.com/apitoken" target="_blank" class="text-blue-600 underline">real-debrid.com/apitoken</a> 에서 발급받을 수 있습니다.<br/><span class="text-red-500">연결 실패 시:</span> 토큰이 정확한지, 인터넷 연결, 브라우저 확장 프로그램(광고 차단 등)을 확인해주세요.</p>
            <div class="flex gap-4 mt-4">
                <button onclick="saveToken()" class="flex-1 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700"><i class="fas fa-save mr-2"></i>저장</button>
                <button onclick="testConnection()" class="flex-1 px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700"><i class="fas fa-plug mr-2"></i>연결 테스트</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Toast Message Container -->
    <div id="toastContainer"></div>

    <!-- ★★★★★ Local Scripts Loading Section ★★★★★ -->
    <script src="cordova.js"></script>
    <script src="sha1.js"></script>
    <script src="bencode.js"></script>
    <script src="src/base32.js"></script>
    
    <!-- Main Application Script -->
    <script src="app.js"></script>
</body>
</html>
