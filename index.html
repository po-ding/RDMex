<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ğŸš€ RDMex</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸš€</text></svg>">
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap:; connect-src 'self' https://api.real-debrid.com https://raw.githubusercontent.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; font-src 'self' https://cdn.jsdelivr.net; script-src 'self' 'unsafe-inline' 'unsafe-eval';">
    
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />
    
    <style>
        #toastContainer { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 90%; max-width: 500px; }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        #statusLog::-webkit-scrollbar, #torrentList::-webkit-scrollbar, #trackerInput::-webkit-scrollbar { width: 8px; }
        #statusLog::-webkit-scrollbar-thumb, #torrentList::-webkit-scrollbar-thumb, #trackerInput::-webkit-scrollbar-thumb { background-color: #a0aec0; border-radius: 4px; }
        #statusLog::-webkit-scrollbar-track, #torrentList::-webkit-scrollbar-track, #trackerInput::-webkit-scrollbar-track { background-color: #edf2f7; }
        .btn-potplayer { background-color: #4b3279; color: white; } .btn-potplayer:hover { background-color: #5d3f99; }
        .btn-stream { background-color: #8B5CF6; color: white; } .btn-stream:hover { background-color: #7C3AED; }
        .btn-rdpage { background-color: #3B82F6; color: white; } .btn-rdpage:hover { background-color: #2563EB; }
        .btn-download { background-color: #10B981; color: white; } .btn-download:hover { background-color: #059669; }
        .btn-link { background-color: #6B7280; color: white; } .btn-link:hover { background-color: #4B5563; }
        .btn-hide { background-color: #9CA3AF; color: white; } .btn-hide:hover { background-color: #6B7280; }
        .btn-delete { background-color: #EF4444; color: white; } .btn-delete:hover { background-color: #DC2626; }
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-800 text-white p-4 shadow-md flex justify-between items-center sticky top-0 z-40">
      <div><h1 class="text-2xl font-bold flex items-center"><i class="fas fa-rocket mr-3"></i>RDMex</h1></div>
      <div id="apiListSize" class="text-right opacity-90 text-xl font-bold"></div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 md:px-6 py-8 max-w-7xl">
      
      <!-- Input Section -->
      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-stretch">
            <div class="flex flex-col gap-4 h-full">
                <div class="flex-grow flex relative min-h-[128px]">
                    <div id="magnetPlaceholder" class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none transition-opacity duration-300">
                        <i class="fas fa-magnet text-4xl text-gray-400"></i>
                        <p class="mt-2 text-sm text-gray-600">ë§ˆê·¸ë„· ë§í¬ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”</p>
                    </div>
                    <textarea id="magnetInput" class="w-full h-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-left bg-transparent z-10"></textarea>
                </div>
                <button onclick="handleConvertUpload(this)" id="convertUploadButton" class="w-full px-4 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition duration-200 flex items-center justify-center text-xl">
                    <i class="fas fa-magnet mr-3"></i> ë§ˆê·¸ë„· / ë³€í™˜ ì—…ë¡œë“œ
                </button>
            </div>
            <div class="flex flex-col gap-4 h-full">
                <div class="flex-grow border-2 border-dashed border-gray-300 rounded-lg p-4 text-center w-full min-h-[128px] flex flex-col justify-center items-center relative cursor-pointer" id="dropZone">
                    <input type="file" id="torrentFile" accept=".torrent" class="hidden" />
                    <div id="dropZoneContent" class="flex flex-col items-center justify-center h-full">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                        <p class="mt-2 text-sm text-gray-600">.torrent íŒŒì¼ì„ ë“œë¡­í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì¶”ê°€</p>
                    </div>
                </div>
                <button onclick="handleDirectUpload(this)" id="directUploadButton" class="w-full px-4 py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition duration-200 flex items-center justify-center text-xl opacity-50 cursor-not-allowed" disabled>
                    <i class="fas fa-file-arrow-up mr-3"></i> íŒŒì¼ ì§ì ‘ ì—…ë¡œë“œ
                </button>
            </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="bg-white rounded-lg shadow-lg">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <h2 class="text-xl font-semibold text-gray-800"><i class="fas fa-list mr-2 text-blue-500"></i>í† ë ŒíŠ¸ ëª©ë¡</h2>
                    <span id="openFolderViewBtn" class="cursor-pointer text-gray-500 hover:text-blue-600 transition-colors" title="ìƒˆ ì°½ì—ì„œ í´ë” ë·°ë¡œ ë³´ê¸°" onclick="openFolderViewInNewWindow()">
                        <i class="fas fa-folder-open text-xl"></i>
                    </span>
                </div>
                <div class="flex gap-2">
                    <button onclick="refreshTorrents()" class="px-3 py-1 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700" title="ìƒˆë¡œê³ ì¹¨"><i class="fas fa-sync-alt"></i></button>
                    <button onclick="deleteCompleted()" class="px-3 py-1 bg-red-600 text-white text-sm font-semibold rounded-lg hover:bg-red-700" title="ì™„ë£Œëœ í•­ëª© ëª¨ë‘ ì‚­ì œ"><i class="fas fa-trash"></i></button>
                </div>
            </div>
            <div id="torrentList" class="p-2" style="min-height: 600px; max-height: 80vh; overflow-y: auto;">
                <p class="text-gray-500 text-center py-8">í† ë ŒíŠ¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
            </div>
        </div>

        <div class="flex flex-col gap-8">
          <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-1 border-b pb-3">
                <h2 class="text-xl font-semibold flex items-center text-gray-800"><i class="fas fa-satellite-dish mr-2 text-purple-500"></i>íŠ¸ë˜ì»¤</h2>
                <div id="trackerUpdateTime" class="text-xs font-bold text-gray-500 ml-3 text-right"></div>
            </div>
            <div class="flex items-center mt-4 mb-2">
              <span class="cursor-pointer text-sm font-medium text-gray-700 flex items-center" onclick="fetchBestTrackers()">
                  <i class="fas fa-sync-alt mr-2 text-purple-500"></i>ìµœì‹  íŠ¸ë˜ì»¤ ë¶ˆëŸ¬ì˜¤ê¸°
              </span>
              <span id="trackerStatusIcon" class="ml-2"></span>
            </div>
            <textarea id="trackerInput" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="RD ì¶”ê°€ ì‹œ ë§ˆê·¸ë„·ì— ì ìš©í•  íŠ¸ë˜ì»¤ ëª©ë¡ì…ë‹ˆë‹¤. ìµœì‹  ëª©ë¡ì„ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤..."></textarea>
          </div>

          <div class="bg-white rounded-lg shadow-lg p-6 flex flex-col">
            <h2 class="text-xl font-semibold mb-4 flex items-center text-gray-800 border-b pb-3"><i class="fas fa-info-circle mr-2 text-blue-500"></i>ìƒíƒœ ë° ë¡œê·¸</h2>
            <div id="statusLog" class="bg-gray-50 rounded-lg p-3 overflow-y-auto text-sm" style="height: 200px;">
                <p id="initialLogMessage" class="text-gray-500">ì¤€ë¹„ ì™„ë£Œ.</p>
            </div>
          </div>
          
          <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold flex items-center text-gray-800"><i class="fas fa-key mr-2 text-yellow-500"></i>API ì„¤ì •</h2>
                <div id="apiCombinedStatus" class="ml-3 text-sm"></div>
            </div>
            <div class="relative">
                <input type="password" id="apiToken" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10" placeholder="Real-Debrid API í† í°ì„ ì…ë ¥í•˜ì„¸ìš”" />
                <button id="toggleApiToken" onclick="toggleTokenVisibility()" class="absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 hover:text-gray-700">
                    <i id="toggleApiIcon" class="fas fa-eye"></i>
                </button>
            </div>
            <p class="text-xs text-gray-500 mt-2">API í† í°ì€ <a href="https://real-debrid.com/apitoken" target="_blank" class="text-blue-600 underline">real-debrid.com/apitoken</a> ì—ì„œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/><span class="text-red-500">ì—°ê²° ì‹¤íŒ¨ ì‹œ:</span> í† í°ì´ ì •í™•í•œì§€, ì¸í„°ë„· ì—°ê²°, ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨(ê´‘ê³  ì°¨ë‹¨ ë“±)ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
            <div class="flex gap-4 mt-4">
                <button onclick="saveToken()" class="flex-1 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700"><i class="fas fa-save mr-2"></i>ì €ì¥</button>
                <button onclick="testConnection()" class="flex-1 px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700"><i class="fas fa-plug mr-2"></i>ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="toastContainer"></div>

    <script src="cordova.js"></script>
    <script src="sha1.js"></script>
    <script src="bencode.js"></script>
    <script src="src/base32.js"></script>
    
    <!-- â˜…â˜…â˜… [ìˆ˜ì •ë¨] app.js íŒŒì¼ í•˜ë‚˜ë§Œ ë¡œë“œí•©ë‹ˆë‹¤. -->
    <script src="app.js"></script>
    
    <script>
        function toggleTokenVisibility() {
            const apiTokenInput = document.getElementById('apiToken');
            const toggleIcon = document.getElementById('toggleApiIcon');
            if (apiTokenInput.type === 'password') {
                apiTokenInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                apiTokenInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }
    </script>
</body>
</html>